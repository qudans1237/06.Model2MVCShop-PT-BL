<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
		PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
		"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="ProductMapper">

	<resultMap  id="productSelectMap" type="product">
		<result property="prodNo" column="prod_no" jdbcType="NUMERIC"/>
		<result property="prodName" column="prod_name" jdbcType="VARCHAR"/>
		<result property="prodDetail" column="prod_detail" jdbcType="VARCHAR"/>
		<result property="manuDate" column="manufacture_day" jdbcType="VARCHAR"/>
		<result property="price" column="price" jdbcType="NUMERIC"/>
		<result property="fileName" column="image_file" jdbcType="VARCHAR"/>
		<result property="regDate" column="reg_date" jdbcType="VARCHAR"/>
	</resultMap>

	<insert id="addProduct"	parameterType="product" >
	 	INSERT
		INTO product 
		VALUES	 (seq_product_prod_no.nextval,#{prodName},#{prodDetail},#{manuDate},#{price},#{fileName},SYSDATE)
	</insert>

	<select id="getProduct"	parameterType="int" resultMap="productSelectMap">
		SELECT
		* 
		FROM product
		WHERE prod_no = #{value}
	</select>
	
	<update	id="updateProduct"	parameterType="product" >
		UPDATE product
		<set>
		prod_name 		= #{prodName},
		prod_detail 	= #{prodDetail},
		manufacture_day = #{manuDate},
		price	 		= #{price},
		image_file 		= #{fileName}
		</set>
		WHERE prod_no = #{prodNo}
	</update>
	
	<select  id="getProductList" parameterType="search" resultMap="productSelectMap">
		SELECT *
		FROM (	SELECT v.* , ROWNUM AS row_seq
				FROM (SELECT *
			  		  FROM PRODUCT 
			  		  <if test="searchCondition != null">
			  		  	<where>
			  		  		<if test="searchCondition == 0 and searchKeyword !='' ">
			  					prod_no like '%'||#{searchKeyword}||'%' 
			  				</if>
			  				<if test="searchCondition == 1 and searchKeyword !='' ">
			  					prod_name like '%'||#{searchKeyword}||'%' 
			  				</if>
			  				<if test="searchCondition == 2 and searchKeyword !='' ">
			  					price like '%'||#{searchKeyword}||'%' 
			  				</if>
			  			</where>
			  			</if>
			  			ORDER BY PROD_NO) v
		 		WHERE ROWNUM &lt;= #{endRowNum} )
		 WHERE row_seq BETWEEN #{startRowNum} AND #{endRowNum} 
	</select>
	<select  id="getTotalCount"  parameterType="search"	 resultType="int">
	  	SELECT COUNT(*)
	  	FROM(	SELECT * 
						FROM product
						<if test="searchCondition != null">
			  		  	<where>
			  		  		<if test="searchCondition == 0 and searchKeyword !='' ">
			  					prod_no like '%' || #{searchKeyword} || '%' and
			  				</if>
			  				<if test="searchCondition == 1 and searchKeyword !='' ">
			  					prod_name like '%' || #{searchKeyword} || '%' and
			  				</if>
			  				<if test="searchCondition == 2 and searchKeyword !='' ">
			  					price like '%' || #{searchKeyword} || '%' and
			  				</if>
			  			</where>
			  			</if> ) countTable						
	 </select>
	
</mapper>